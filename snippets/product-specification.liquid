{%- if product.description -%}
	<div class="product-description para">
		<h2 class="accordion__title">Product Details</h2>
		{{ product.description }}
	</div>
{%- endif -%}
{% comment %}
    Use the product type to find the ACF attributes fields per product.

    Becuase the ACF namespace is capped at 20 chars, I use the slice filter to get
    the max length possible and return the productMeta for each product type.

    13 product types altogether.
{% endcomment %}
{% assign current_variant = product.selected_or_first_available_variant %}
{% assign productType = product.type | downcase | replace: ' ', '_' | slice: 0, 20 %}
{% comment %}
    Get the attributes for the products, the shared and ones specific to the product type.
{% endcomment %}
{% assign productNumber = current_variant.metafields.product_config.product_number %}
{% assign productAttributesShared = product.metafields.product_attribute %}
{% assign productAttributesType = product.metafields[productType] %}

{% comment %}
    Override attributes with variant
{% endcomment %}
{% if product.variants.size > 1 %}
	{% assign productAttributesVariant = current_variant.metafields[productType] %}
{% endif %}
{% comment %}
    attributeLabels are the labels for each attribute that have been set on a shop
    level. This is due to the attributes being added on a product by product basis,
    so having to fill out the labels each time would not make sense.
{% endcomment %}
{% assign productAttributesSharedLabels = shop.metafields.product_attribute %}
{% assign productAttributesTypeLabels = shop.metafields[productType] %}
{% assign productAttributesTypeLvtLabels = shop.metafields['lvt'] %}

{%- assign productType = product.type -%}

{%- if productType == "Engineered Wood" or productType == "Solid Wood" -%}
	{%- assign woodProduct = true -%}
{%- else -%}
	{%- assign woodProduct = false -%}
{%- endif -%}

{%- assign filterFields = product.metafields.filters -%}
{%- assign variantFilterFields = product.selected_or_first_available_variant.metafields.filters -%}
{%- assign variantAttributeFields = product.selected_or_first_available_variant.metafields.product_attribute -%}

{%- assign accessoryType = product.metafields.filters.accessory_type -%}
{%- if accessoryType == "Adhesive" or product.selected_or_first_available_variant.metafields.product_config.sale_metric == "Box" -%}
	{%- assign adhesive = true -%}
{%- else -%}
	{%- assign adhesive = false -%}
{%- endif -%}

{%- if productAttributesShared != blank or productAttributesType != blank or filterFields != blank -%}
	<div class="product-attributes">
		<h2 class="accordion__title">Product Specification</h2>
		<div class="product-attributes__table">
			{% comment %}
                Shared attributes
            {% endcomment %}
			{%- if productNumber -%}
				<div class="product-attributes__row cf">
					<div class="product-attributes__column product-attributes__column--dark">
						Product Number
					</div>
					<div class="product-attributes__column product-attributes__column--light" data-visual-data="product_number">
						{{ productNumber }}
					</div>
				</div>
			{%- endif -%}
			{%- for filter in variantFilterFields -%}
				{%- assign attributeKey = filter | first -%}
				{%- assign attributeValue = filter | last -%}
				{%- if attributeKey != "rooms" and attributeKey != "pack_size" and attributeKey != "installation_method" -%}
					<div class="product-attributes__row cf">
						<div class="product-attributes__column product-attributes__column--dark">
							{%- if attributeKey == "width" -%}
								{{ 'products.attributes.width' | t }}
							{%- elsif attributeKey == "installation_method_list" -%}
								{{ 'products.attributes.installation_method' | t }}
							{%- elsif attributeKey == "thickness" -%}
								{{ 'products.attributes.thickness' | t }}
							{%- elsif attributeKey == "underfloor_heating" -%}
								{{ 'products.attributes.underfloor_heating' | t }}
							{%- elsif attributeKey == "shade" -%}
								{{ 'products.attributes.shade' | t }}
							{%- elsif attributeKey == "effect" -%}
								{{ 'products.attributes.effect' | t }}
							{%- elsif attributeKey == "design" -%}
								{{ 'products.attributes.design' | t }}
							{%- elsif attributeKey == "wear_layer" -%}
								{{ 'products.attributes.wear_layer' | t }}
							{%- elsif attributeKey == "for_use_with" -%}
								{{ 'products.attributes.for_use_with' | t }}
							{%- elsif attributeKey == "type" -%}
								{{ 'products.attributes.type' | t }}
							{%- elsif attributeKey == "wood_species" -%}
								{{ 'products.attributes.wood_species' | t }}
							{%- elsif attributeKey == "finish" -%}
								{{ 'products.attributes.finish' | t }}
							{%- elsif attributeKey == "rating" -%}
								{{ 'products.attributes.rating' | t }}

							{%- elsif attributeKey == "rooms" -%}
							{%- elsif attributeKey == "for-use-with" -%}
								{{ 'products.attributes.for-use-with' | t }}
							{%- elsif attributeKey == "length" -%}
								{{ 'products.attributes.length' | t }}
							{%- elsif attributeKey == "pack_size" -%}
								{{ 'products.attributes.pack_size' | t }}
							{% elsif attributeKey == "range" %}
								{{ 'products.attributes.range' | t }}
							{%- elsif attributeKey == "pile" -%}
								{{ 'products.attributes.pile' | t }}
							{%- elsif attributeKey == "composition" -%}
								{{ 'products.attributes.composition' | t }}
							{%- elsif attributeKey == "pile_height" -%}
								{{ 'products.attributes.pile_height' | t }}
							{%- elsif attributeKey == "total_carpet_height" -%}
								{{ 'products.attributes.total_carpet_height' | t }}
							{%- elsif attributeKey == "total_carpet_weight" -%}
								{{ 'products.attributes.total_carpet_weight' | t }}
							{%- elsif attributeKey == "fire_resistance" -%}
								{{ 'products.attributes.fire_resistance' | t }}
							{%- elsif attributeKey == "carpet_pattern" -%}
								{{ 'products.attributes.carpet_pattern' | t }}
							{%- elsif attributeKey == "colour" -%}
								{{ 'products.attributes.colour' | t }}
							{%- elsif attributeKey == "product_number" -%}
								{{ 'products.attributes.product_number' | t }}
							{%- elsif attributeKey == "sale_metric" -%}
								{{ 'products.attributes.sale_metric' | t }}
							{%- elsif variantFilterFields[attributeKey] -%}
								{{ variantFilterFields[attributeKey] }}
							{% endif %}
						</div>
						<div
							class="product-attributes__column product-attributes__column--light"
							data-visual-data="{{- attributeKey | downcase | replace: ' ', '_' -}}"
						>

							{%- if attributeKey == "rooms" -%}
							{%- elsif variantFilterFields[attributeKey].value.first -%}
								{%- for value in variantFilterFields[attributeKey].value -%}
									{{ value }}{% unless forloop.last == true %}, {% endunless %}
								{%- endfor -%}
							{%- elsif variantFilterFields[attributeKey] -%}
								{{ variantFilterFields[attributeKey] }}
							{%- else -%}
								{{ attributeValue }}
							{%- endif -%}
							{%- if attributeKey == 'length' or attributeKey == 'width' -%}

							{%- endif -%}
							{%- if attributeKey == 'pack_size' and adhesive == false -%}
								m²
							{%- endif -%}

						</div>
					</div>
				{%- endif -%}
			{%- endfor -%}
			{%- for filter in variantAttributeFields -%}
				{%- assign attributeKey = filter | first -%}
				{%- assign attributeValue = filter | last -%}

				{%- assign showWidth = false -%}
				{%- if filterFields contains "width" -%}
					{%- assign showWidth = false -%}
				{%- elsif attributeKey == "width" -%}
					{%- assign showWidth = true -%}
				{%- endif -%}

				{%- if attributeKey == "pack_size" or showWidth == true -%}
					<div class="product-attributes__row cf">
						<div class="product-attributes__column product-attributes__column--dark">
							{%- if attributeKey == "pack_size" -%}
								{{ 'products.attributes.pack_size' | t }}
							{%- elsif attributeKey == "width" -%}
								{{ 'products.attributes.width' | t }}
							{%- endif -%}
						</div>
						<div
							class="product-attributes__column product-attributes__column--light"
							data-visual-data="{{- attributeKey | downcase | replace: ' ', '_' -}}"
						>
							{%- if variantAttributeFields[attributeKey].value.first -%}
								{%- for value in variantAttributeFields[attributeKey].value -%}
									{{ value }}{% unless forloop.last == true %}, {% endunless %}
								{%- endfor -%}
							{%- elsif variantAttributeFields[attributeKey] -%}
								{{ variantAttributeFields[attributeKey] }}
							{%- else -%}
								{{ attributeValue }}
							{%- endif -%}
							{%- if attributeKey == "pack_size" and adhesive == false -%}
								m²
							{%- endif -%}
						</div>
					</div>
				{%- endif -%}
			{%- endfor -%}
			{%- for filter in filterFields -%}
				{%- assign attributeKey = filter | first -%}
				{%- assign attributeValue = filter | last -%}
				{%- assign variantFilter = variantFilterFields[attributeKey] -%}
				{%- if attributeKey != "price-range" and variantFilter == blank and attributeKey != "rooms" and attributeKey != "installation_method" -%}
					{%- unless attributeKey contains "price" -%}
						{%- unless attributeKey == "material" and woodProduct == true -%}
							{%- unless attributeKey == "length" and variantFilterFields != blank -%}
								<div class="product-attributes__row cf">
									<div class="product-attributes__column product-attributes__column--dark">
										{%- if attributeKey == "width" -%}
											{{ 'products.attributes.width' | t }}
										{%- elsif attributeKey == "installation_method_list" -%}
											{{ 'products.attributes.installation_method' | t }}
										{%- elsif attributeKey == "thickness" -%}
											{{ 'products.attributes.thickness' | t }}
										{%- elsif attributeKey == "underfloor_heating" -%}
											{{ 'products.attributes.underfloor_heating' | t }}
										{%- elsif attributeKey == "shade" -%}
											{{ 'products.attributes.shade' | t }}
										{%- elsif attributeKey == "effect" -%}
											{{ 'products.attributes.effect' | t }}
										{%- elsif attributeKey == "design" -%}
											{{ 'products.attributes.design' | t }}
										{%- elsif attributeKey == "wear_layer" -%}
											{{ 'products.attributes.wear_layer' | t }}
										{%- elsif attributeKey == "for_use_with" -%}
											{{ 'products.attributes.for_use_with' | t }}
										{%- elsif attributeKey == "type" -%}
											{{ 'products.attributes.type' | t }}
										{%- elsif attributeKey == "wood_species" -%}
											{{ 'products.attributes.wood_species' | t }}
										{%- elsif attributeKey == "finish" -%}
											{{ 'products.attributes.finish' | t }}
										{%- elsif attributeKey == "rating" -%}
											{{ 'products.attributes.rating' | t }}
										{%- elsif attributeKey == "rooms" -%}
										{%- elsif attributeKey == "for-use-with" -%}
											{{ 'products.attributes.for-use-with' | t }}
										{%- elsif attributeKey == "length" -%}
											{{ 'products.attributes.length' | t }}
										{%- elsif attributeKey == "pack_size" -%}
											{{ 'products.attributes.pack_size' | t }}
										{% elsif attributeKey == "range" %}
											{{ 'products.attributes.range' | t }}
										{%- elsif attributeKey == "pile" -%}
											{{ 'products.attributes.pile' | t }}
										{%- elsif attributeKey == "composition" -%}
											{{ 'products.attributes.composition' | t }}
										{%- elsif attributeKey == "pile_height" -%}
											{{ 'products.attributes.pile_height' | t }}
										{%- elsif attributeKey == "total_carpet_height" -%}
											{{ 'products.attributes.total_carpet_height' | t }}
										{%- elsif attributeKey == "total_carpet_weight" -%}
											{{ 'products.attributes.total_carpet_weight' | t }}
										{%- elsif attributeKey == "fire_resistance" -%}
											{{ 'products.attributes.fire_resistance' | t }}
										{%- elsif attributeKey == "carpet_pattern" -%}
											{{ 'products.attributes.carpet_pattern' | t }}
										{%- elsif attributeKey == "colour" -%}
											{{ 'products.attributes.colour' | t }}
										{%- elsif attributeKey == "edge_detail" -%}
											{{ 'products.attributes.edge_detail' | t }}
										{%- elsif attributeKey == "material" -%}
											{{ 'products.attributes.material' | t }}
										{%- elsif attributeKey == "tile_type" -%}
											{{ 'products.attributes.tile_type' | t }}
										{%- elsif attributeKey == "product_number" -%}
											{{ 'products.attributes.product_number' | t }}
										{%- elsif attributeKey == "pieces_per_pack" -%}
											{{ 'products.attributes.pieces_per_pack' | t }}
										{%- elsif attributeKey == "sale_metric" -%}
											{{ 'products.attributes.sale_metric' | t }}
										{%- elsif filterFields[attributeKey] -%}
											{{ filterFields[attributeKey] }}
										{%- endif -%}
									</div>
									<div
										class="test product-attributes__column product-attributes__column--light"
										data-visual-data="{{- attributeKey | downcase | replace: ' ', '_' -}}"
									>
										{%- if variantFilter != blank -%}
											{{ variantFilter }}
										{%- elsif attributeKey == "rooms" -%}
										{%- elsif filterFields[attributeKey].value.first -%}
											{%- for value in filterFields[attributeKey].value -%}
												{{ value }}{% unless forloop.last == true %}, {% endunless %}
											{%- endfor -%}
										{%- elsif filterFields[attributeKey] -%}
											{{ filterFields[attributeKey] }}
										{%- else -%}
											{{ attributeValue }}
										{%- endif -%}
										{%- if attributeKey == 'length' or attributeKey == 'width' -%}

										{%- endif -%}
										{%- if attributeKey == 'pack_size' and adhesive == false -%}
											m²
										{%- endif -%}
									</div>
								</div>
							{%- endunless -%}
						{%- endunless -%}
					{%- endunless -%}
				{%- endif -%}
			{%- endfor -%}
			{%- for attribute in productAttributesShared -%}
				{%- assign attributeKey = attribute | first -%}
				{%- assign attributeValue = attribute | last -%}

				{%- if attributeKey == "width" -%}
				{%- elsif attributeKey == "installation_method_list" -%}
				{%- elsif attributeKey == "thickness" -%}
				{%- elsif attributeKey == "underfloor_heating" -%}
				{%- elsif attributeKey == "shade" -%}
				{%- elsif attributeKey == "effect" -%}
				{%- elsif attributeKey == "design" -%}
				{%- elsif attributeKey == "wear_layer" -%}
				{%- elsif attributeKey == "for_use_with" -%}
				{%- elsif attributeKey == "type" -%}
				{%- elsif attributeKey == "wood_species" -%}
				{%- elsif attributeKey == "finish" -%}
				{%- elsif attributeKey == "rating" -%}
				{%- elsif attributeKey == "room" -%}
				{%- elsif attributeKey == "length" and variantFilterFields != blank and product.variants.size > 1 -%}
				{%- elsif attributeKey == "pack_size" and variantFilterFields != blank and product.variants.size > 1 -%}
				{%- elsif attributeKey == "range" -%}
				{%- elsif attributeKey == "pile" -%}
				{%- elsif attributeKey == "composition" -%}
				{%- elsif attributeKey == "pile_height" -%}
				{%- elsif attributeKey == "total_carpet_height" -%}
				{%- elsif attributeKey == "total_carpet_weight" -%}
				{%- elsif attributeKey == "fire_resistance" -%}
				{%- elsif attributeKey == "carpet_pattern" -%}
				{%- elsif attributeKey == "colour" -%}
				{%- elsif attributeKey == "product_number" -%}
				{%- elsif attributeKey == "sale_metric" -%}
				{%- else -%}
					<div class="product-attributes__row cf">
						<div class="product-attributes__column product-attributes__column--dark">
							{% if productAttributesSharedLabels[attributeKey] %}
								{{ productAttributesSharedLabels[attributeKey] }}
							{% elsif productAttributesTypeLabels[attributeKey] %}
								{{ productAttributesTypeLabels[attributeKey] }}
							{% else %}
								{{ attributeKey | capitalize | replace: '_', ' ' -}}
							{% endif %}
						</div>
						<div
							class="product-attributes__column product-attributes__column--light"
							data-visual-data="{{- attributeKey | downcase | replace: ' ', '_' -}}"
						>
							{%- if attributeKey == "brand" -%}
								{{ product.vendor }}
							{% elsif productAttributesVariant[attributeKey] %}
								{{ productAttributesVariant[attributeKey] }}
							{% else %}
								{{ attributeValue }}
							{%- endif -%}
							{%- if attributeKey == 'pack_size' and adhesive == false -%}
								m²
							{%- endif -%}
						</div>
					</div>
				{%- endif -%}
			{%- endfor -%}
			{% comment %}
                Type specific attributes
            {% endcomment %}
			{%- for attribute in productAttributesType -%}
				{%- assign attributeKey = attribute | first -%}
				{%- assign attributeValue = attribute | last -%}
				{%- if attributeKey == "width" -%}

				{%- elsif attributeKey == "installation_method_list" -%}
				{%- elsif attributeKey == "thickness" -%}
				{%- elsif attributeKey == "underfloor_heating" -%}
				{%- elsif attributeKey == "shade" -%}
				{%- elsif attributeKey == "effect" -%}
				{%- elsif attributeKey == "design" -%}
				{%- elsif attributeKey == "wear_layer" -%}
				{%- elsif attributeKey == "for_use_with" -%}
				{%- elsif attributeKey == "type" -%}
				{%- elsif attributeKey == "wood_species" -%}
				{%- elsif attributeKey == "finish" -%}
				{%- elsif attributeKey == "rating" -%}
				{%- elsif attributeKey == "length" and variantFilterFields != blank -%}
				{%- elsif attributeKey == "pack_size" and variantFilterFields != blank -%}
				{%- elsif attributeKey == "rooms" -%}
				{%- elsif attributeKey == "range" -%}
				{%- elsif attributeKey == "pile" -%}
				{%- elsif attributeKey == "composition" -%}
				{%- elsif attributeKey == "pile_height" -%}
				{%- elsif attributeKey == "total_carpet_height" -%}
				{%- elsif attributeKey == "total_carpet_weight" -%}
				{%- elsif attributeKey == "fire_resistance" -%}
				{%- elsif attributeKey == "carpet_pattern" -%}
				{%- elsif attributeKey == "colour" -%}
				{%- elsif attributeKey == "product_number" -%}
				{%- elsif attributeKey == "sale_metric" -%}

				{%- elsif attributeKey == "built_in_underlay" -%}

				{%- else -%}
					<div class="product-attributes__row cf">
						<div class="product-attributes__column product-attributes__column--dark">
							{%- if productAttributesSharedLabels[attributeKey] -%}
								{{ productAttributesSharedLabels[attributeKey] }}
							{%- elsif productAttributesTypeLabels[attributeKey] -%}
								{{ productAttributesTypeLabels[attributeKey] }}
							{%- else -%}
								{{ attributeKey | capitalize | replace: '_', ' ' }}
							{%- endif -%}
						</div>
						<div class="product-attributes__column product-attributes__column--light" data-visual-data="{{- attributeKey | downcase | replace: ' ', '_' -}}">
							{%- if productAttributesVariant[attributeKey] -%}
								{{ productAttributesVariant[attributeKey] }}
							{%- else -%}
								{{ attributeValue }}
							{%- endif -%}
						</div>
					</div>
				{%- endif -%}
			{%- endfor -%}
			{% if product.metafields.lvt.built_in_underlay %}
				<div class="product-attributes__row cf">
					<div class="product-attributes__column product-attributes__column--dark">
						{%- if productAttributesSharedLabels['built_in_underlay'] -%}
							{{ productAttributesSharedLabels['built_in_underlay'] }}
						{%- elsif productAttributesTypeLvtLabels['built_in_underlay'] -%}
							{{ productAttributesTypeLvtLabels['built_in_underlay'] }}
						{%- else -%}
							{{ 'built_in_underlay' | capitalize | replace: '_', ' ' }}
						{%- endif -%}
					</div>
					<div class="product-attributes__column product-attributes__column--light" data-visual-data="{{- 'built_in_underlay' | downcase | replace: ' ', '_' -}}">
						{%- if productAttributesVariant['built_in_underlay'] -%}
							{{ productAttributesVariant['built_in_underlay'] }}
						{%- else -%}
							{{ product.metafields.lvt.built_in_underlay }}
						{%- endif -%}
					</div>
				</div>
			{% endif %}
			<div class="product-attributes__row cf">
				<div class="product-attributes__column product-attributes__column--dark">
					{{ 'products.attributes.product_type' | t }}
				</div>
				<div class="product-attributes__column product-attributes__column--light" data-visual-data="{{- attributeKey | downcase | replace: ' ', '_' -}}">
					{{ product.type }}
				</div>
			</div>
			{% if product.vendor %}
				<div class="product-attributes__row cf">
					<div class="product-attributes__column product-attributes__column--dark">
						Brand
					</div>
					<div class="product-attributes__column product-attributes__column--light" data-visual-data="{{- 'vendor' | downcase | replace: ' ', '_' -}}">
						{{ product.vendor }}
					</div>
				</div>
			{% endif %}
		</div>
	</div>
{%- endif -%}